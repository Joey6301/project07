"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="c480bf94-ce82-5ca3-8c13-505be84af8e0")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[3041],{469126:(e,t,a)=>{a.d(t,{n:()=>n});var s=a(999667);let n=(0,a(4881).Wh)(()=>(0,s.eU)(null))},264530:(e,t,a)=>{a.d(t,{Nm:()=>r,df:()=>i,o0:()=>n});var s=a(273664);let n=(0,s.H)(!1),i=(0,s.H)(null),r=(0,s.H)(null)},404655:(e,t,a)=>{a.d(t,{N:()=>n,l:()=>s});let s=(0,a(273664).H)(null);function n(e){return e?"code"===e.type?e.fullFilePath:"editedFiles"===e.type?e.files.join(", "):"view_tool"===e.toolName?e.partialArgs.path:null:null}},605808:(e,t,a)=>{a.d(t,{En:()=>c,Ic:()=>u,Pe:()=>d,gC:()=>o});var s=a(848318),n=a(999667),i=a(4881);let r=(0,i.Wh)(()=>(0,n.eU)([])),l=(0,i.Wh)(()=>(0,n.eU)(new Map));function o(){let e=n.zl.get(l);n.zl.set(r,Array.from(e.values()))}function c(){n.zl.set(l,new Map)}function u(){n.zl.set(r,[])}function d(){let[e,t]=(0,n.fp)(l),[a,i]=(0,n.fp)(r),o=s.useCallback(()=>{i([])},[i]);return{communityAttribution:e,addCommunityAttribution:s.useCallback((e,a)=>{t(t=>{let s=new Map(t);return s.set(e,a),s})},[t]),communityAttributionDisplay:a,clearCommunityAttributionDisplay:o}}},799770:(e,t,a)=>{a.d(t,{Z:()=>r,x:()=>l});var s=a(486807),n=a(186606),i=a(52813);function r(e,t,a){let r=(0,s.ic)(n.K$p.SYSTEM_MESSAGE,e.id,()=>((0,i.vA)(void 0!==n.glU,"Fullscreen must be defined"),n.glU.generateUniqueID()));return r.textContent=(0,s.J6)({type:"restore",codeSnapshot:t,plainText:"",title:a}),r}function l(e,t,a,r){let l=(0,s.ic)(n.K$p.SYSTEM_MESSAGE,e.id,()=>((0,i.vA)(void 0!==n.glU,"Fullscreen must be defined"),n.glU.generateUniqueID()));return l.textContent=(0,s.J6)({type:"manual_edit",changedFiles:t,codeSnapshot:a,plainText:"",title:r}),l}},647942:(e,t,a)=>{a.d(t,{Oy:()=>c,Us:()=>d,lm:()=>u});var s=a(486807),n=a(186606),i=a(647029),r=a(795234);let l=i.z.record(i.z.string(),i.z.string()),o=new class{constructor(){this.CreateCodeSnapshotValidator=(0,r.vh)(),this.GetCodeSnapshotValidator=(0,r.vh)()}createCodeSnapshot(e){return this.CreateCodeSnapshotValidator.validate(async({xr:t})=>(l.parse(e.codeFiles),await t.post(`/api/rev/${e.fileKey}/code_snapshot`,{code_files:e.codeFiles})))}getCodeSnapshot(e){return this.GetCodeSnapshotValidator.validate(async({xr:t})=>await t.get(`/api/rev/${e.fileKey}/code_snapshot/${e.codeSnapshotKey}`))}};async function c({fileKey:e,codeFiles:t}){let{code_snapshot_key:a,file_version_id:s}=(await o.createCodeSnapshot({fileKey:e,codeFiles:t})).data.meta;return{codeSnapshotKey:a,fileVersionId:s}}async function u({fileKey:e,codeSnapshotKey:t}){return(await o.getCodeSnapshot({fileKey:e,codeSnapshotKey:t})).data.meta.code_files}async function d({messages:e,codeFiles:t,fileKey:a}){let i=await c({fileKey:a,codeFiles:t});return i?e.map(e=>{if(e.type===n.K$p.ASSISTANT_MESSAGE){let t=(0,s.lr)(e.textContent);t.codeSnapshot=i,e.textContent=(0,s.J6)(t)}return e}):e}},267266:(e,t,a)=>{a.d(t,{i:()=>l,n:()=>r});var s=a(734341);if(443==a.j)var n=a(660376);var i=a(580494);function r(){return(0,i.k)().bake_canary_model?s.D.CLAUDE_4_SONNET:s.D.CLAUDE_3_7_SONNET}function l(){let e=r();switch(e){case s.D.CLAUDE_3_7_SONNET:return"Claude Sonnet 3.7";case s.D.CLAUDE_4_SONNET:return"Claude Sonnet 4";default:(0,n.xb)(e)}}},277518:(e,t,a)=>{a.d(t,{yc:()=>B,Oz:()=>W});var s=a(486807),n=a(380221),i=a(982618),r=a(92454),l=a(938982),o=a(186606),c=a(320953),u=a(768618),d=a(580494),h=a(999667),f=a(52813),m=a(615233),p=a(998568),g=a(182317),y=a(967688),v=a(642935),_=a(101872),b=a(303397),C=a(730143),w=a(633468),E=a(660580),S=a(551011),k=a(255130),A=a(469126),T=a(264530),D=a(404655),x=a(897659),M=a(559537),N=a(277311),I=a(605808),O=a(887437),F=a(947943),U=a(644810),z=a(392665),R=a(20287),H=a(304738),V=a(855892),K=a(522277),L=a(840270),$=a(111592),j=a(481694),P=a(799770),G=a(647942),q=a(162293),J=a(314753);async function X({chatMessagesNode:e,newMessage:t,rawUserChatDetails:a,userId:n,featureType:i,forceCompression:r,canUseSupabase:l,model:u}){c.l7.ai("code-chat-clear-import-data",()=>{e.chatMessages=(0,s.Li)(e.chatMessages)});let d=e.chatCompressionState?e.chatMessages.slice(e.chatCompressionState.startIndex):e.chatMessages,f=(0,s.Vs)(e.chatCompressionState,!!r),m=[t],p=function({newMessage:e,prevMessage:t,userId:a}){if(!o.glU||e.type===o.K$p.TOOL_MESSAGE||!t||t.type!==o.K$p.ASSISTANT_MESSAGE)return;let n=t.toolCalls;if(0===n.length)return;let i=n[0];if(!i)return;let r=i.toolName,l=i.toolCallId;if(s.AD.includes(r))return{id:o.glU.generateUniqueID(),type:o.K$p.TOOL_MESSAGE,userId:a,textContent:(0,s.J6)({plainText:""}),sentAt:Date.now(),toolCalls:[],toolResults:[(0,s.k4)({toolCallId:l,toolName:r,result:{success:!1,message:"Was not successful."}})]}}({newMessage:t,prevMessage:d[d.length-1],userId:n});p&&(d.push(p),m=[p,...m]);let g=d.map(s.oh),y=(0,s.oh)(t);if(i===x.lV.CODE_IN_SITES&&"user"===y.role){let e=h.zl.get(S.f3);if(e)try{let{png:t}=await e.snapshotPage({maxSnapshotWidth:1568,maxSnapshotHeight:1568}),a=new FileReader,s=new Promise(e=>{a.onloadend=()=>e(a.result),a.readAsDataURL(t)});y.nodeThumbnailBase64=await s}catch(e){}}g.push(y);let v=l?await Q():void 0;return{exchangeInit:m,codeChatRequest:{rawUserChatDetails:a,chats:g,chatCompression:f,files:i===x.lV.CODE_IN_SITES?{[e.codeFileFullPathWithoutScheme]:e.sourceCode}:Object.fromEntries(Object.entries((0,j.Iz)()).map(([e,t])=>[e,t.sourceCode])),supabase:v,supabaseEnabled:l,model:u}}}async function Y({featureType:e,chatMessagesNode:t,newMessage:a,rawUserChatDetails:u,user:m,persistentEntityId:g,clientLifecycleId:y,setInput:b,clientGeneratedRequestUuid:C,forceCompression:w,canUseSupabase:E,model:S}){let T,U;(0,f.vA)(void 0!==o.glU,"Fullscreen must be defined"),(0,I.Ic)();let{exchangeInit:R,codeChatRequest:H}=await X({chatMessagesNode:t,newMessage:a,rawUserChatDetails:u,userId:m.id,featureType:e,forceCompression:w,canUseSupabase:E,model:S}),V=(0,d.k)().bake_smooth_chat_streaming?new J.t:void 0,K=new s.P5({initialMessages:R,userId:m.id,nodeIdGenerator:()=>((0,f.vA)(void 0!==o.glU,"Fullscreen must be defined"),o.glU.generateUniqueID()),initializeWithAssistantMessage:!0});(0,k.YZ)({node:t.guid,messages:K.getExchange(),fileUpdates:[],isTyping:!1});let L=new AbortController;h.zl.set((0,k.Z3)(t.guid),L);let $=new Promise(e=>{L&&L.signal.addEventListener("abort",e)});async function P(e){e&&await e.cancel(),t&&(0,k.wi)(t.guid,{switchToPreview:!0}),(0,j.zK)(Q),V?.abort();let{plainText:n}=(0,s.H5)(a.textContent);b(n),(0,M.WH)()}let G=performance.now(),q=function(e){let t=null;switch(e){case x.lV.FIGMAKE:t=v.Ay.shared.generateFigMake;break;case x.lV.CODE_IN_SITES:t=v.Ay.shared.generateLivingDesigns;break;default:(0,f.xb)(e)}return t}(e);(0,f.vA)(q,"Stream function must be defined");let Y=q(H,{...(0,_.Ay)(),persistentEntityId:g,clientLifecycleId:y,clientGeneratedRequestUuid:C},{abortSignal:L.signal}),B=Z();function W(){return L&&L.signal.aborted?(T="user_cancelled",!0):Z()!==B?(T="user_left",!0):(!t||!t.isAlive)&&(T="missing_node",!0)}let Q=[],ee={};try{let a=await Promise.race([Y,$]);if(W())return await P(),null;(0,f.vA)(a,"Response must be defined");let i=a.getReader(),r=(0,j.Iz)(),o=!1,u=a=>{"code"===a.type?(function({response:e,fileUpdates:t,codeFiles:a,newlyCreatedCodeFiles:s,featureType:n,chatMessagesNode:i}){let r=e.file;n===x.lV.CODE_IN_SITES&&(r=i.codeFileFullPathWithoutScheme),e.reset&&(t[r]="");let l=(t[r]||"")+e.code;t[r]=l,h.zl.set((0,D.l)(i.guid),{type:"code",fullFilePath:r}),n===x.lV.FIGMAKE&&function({codeFiles:e,writeFilePath:t,response:a,newlyCreatedCodeFiles:s}){let{codeFile:n,created:i}=(0,j.Ur)(e,t,a.code);n&&c.l7.ai("code-chat",()=>{(0,F.Zr)(n)}),n&&i&&s.push(n)}({codeFiles:a,writeFilePath:r,response:e,newlyCreatedCodeFiles:s})}({response:a,fileUpdates:ee,codeFiles:r,newlyCreatedCodeFiles:Q,featureType:e,chatMessagesNode:t}),o||(h.zl.set(z.j,z.I.CODE),o=!0)):"chat-compression"===a.type?(0,s.yZ)(t,a):"plan"===a.type&&a.title&&h.zl.set(A.n,a.title),function(e,t){let a=(0,D.l)(t);if("code"===e.type)h.zl.set(a,{type:"code",fullFilePath:e.file});else if("toolCall"===e.type){let t=n.JZ.safeParse({toolName:e.toolName,partialArgs:e.partialArgs});t.success?"multi_edit_tool"!==t.data.toolName&&h.zl.set(a,{type:"tool",...t.data}):(0,p.$D)(l.e.AI_FOR_PRODUCTION,Error("Invalid tool data for code chat artifact"),{extra:{partialArgs:e.partialArgs,error:t.error},tags:{toolName:e.toolName}})}else"message"===e.type||"summary"===e.type?h.zl.set(a,null):"plan"===e.type?(h.zl.set(a,null),e.title&&h.zl.set(A.n,e.title)):"editedFiles"===e.type&&h.zl.set(a,{type:"editedFiles",files:e.files})}(a,t.guid),K.processResponseDelta(a),(0,k.YZ)({node:t.guid,messages:K.getExchange(),fileUpdates:Object.entries(ee).map(([e,t])=>({name:e,contents:t})),isTyping:!1}),U||(U=performance.now())};for(V?.onRender(u);;){let e=await Promise.race([i.read(),$]);if(W())return await P(i),null;let{done:t,value:a}=e;if(a&&(V?V.queue(a):u(a)),t)break}}catch(a){return a instanceof r.G1||a instanceof i.CortexErrorV2?h.zl.set((0,N.QK)(t?.guid||""),{error:a,cortexClientGeneratedRequestUuid:C}):h.zl.set((0,N.QK)(t?.guid||""),{error:a}),(0,x.Ho)(a,e,x.a5.SEND_MESSAGE),P(),null}finally{V&&await V.done();let t=performance.now();(0,O.oL)(e,G,U,t,K.getToolCalls(),g,y,T)}return{exchangedMessages:K.getExchange(),fileUpdates:ee}}async function B({newMessage:e,user:t,chatMessagesNode:a,rawUserChatDetails:n,featureType:i,persistentEntityId:r,clientLifecycleId:c,setInput:d,fileKey:v,forceCompression:_,canUseSupabase:C,model:E}){let S;let A=a.chatMessages;(0,O.rH)(i,A.length,r,c),(0,m.b5)()&&(S=(0,g.g)());let D=await Y({featureType:i,chatMessagesNode:a,newMessage:e,rawUserChatDetails:n,user:t,persistentEntityId:r,clientLifecycleId:c,setInput:d,clientGeneratedRequestUuid:S,forceCompression:_,canUseSupabase:C,model:E});if(D){let{exchangedMessages:t,fileUpdates:n}=D;(0,O.eM)({featureType:i,clientLifecycleId:c,persistentEntityId:r,fileUpdates:n}),(t.length>0||Object.keys(n).length>0)&&function(e,t,a,n,i){let r=i===x.lV.FIGMAKE?(0,j.Iz)():(0,j.mf)(t),c=(0,s.Li)(e),d=t.chatMessages||[],g=[...d,...c];if($.H.ai("update-source-code-and-chat-messages",()=>{for(let[e,s]of((0,f.vA)(void 0!==o.glU,"Fullscreen must be defined"),t.chatMessages=g,Object.entries(a))){let{codeFile:a}=(0,j.Ur)(r,e,s);a&&(a.sourceCode=s,h.zl.set((0,T.Nm)(t.guid),"assistant"))}b.Y5.commit()}),n&&Object.keys(a).length>0){let e={...Object.fromEntries(Object.entries(r).map(([e,t])=>[e,t.sourceCode])),...a};(0,G.Us)({messages:c,codeFiles:e,fileKey:n}).then(e=>{$.H.ai("enrich-exchange-messages-with-code-snapshots",()=>{let a=[...d,...e];t.chatMessages=a})}).catch(e=>{(0,p.$D)(l.e.AI_FOR_PRODUCTION,Error(`Failed to generate code snapshot: ${e}`))})}if(i===x.lV.FIGMAKE){!function(e){let t=(0,u.UN)();if(!t.getInternalCanvas())return;let a=e.map(e=>{if(e.type!==o.K$p.USER_MESSAGE)return null;let{imports:t}=(0,s.MK)(e.textContent);return t&&0!==t.length?t.map(e=>"node"===e.type&&e.communityAttribution?e.communityAttribution:null).filter(e=>!!e):null}).filter(e=>!!e).flat().filter((e,t,a)=>t===a.findIndex(t=>t.hubFileId===e.hubFileId)),n=(0,j._J)(U.e);$.H.system("update-attributions",()=>{if(!n){let e=o.glU?.createNewCodeFile(U.SE,"",null);if(!e||!(n=t.get(e)))return}let e=(0,y.t)("figmake.chat.unsplash_attribution.attribution_comment"),s=[(0,y.t)("figmake.chat.shadcn_attribution.attribution_comment"),e,...a.map(e=>e?(0,y.t)("figmake.chat.community_attribution.attribution_comment",{creatorName:e.creatorName,hubFileName:e.hubFileName,hubFileLink:`${(0,m.Ay)().figma_url}${(0,w.X$)(e.hubFileId)}`,licenseName:"CC BY 4.0",licenseLink:"https://creativecommons.org/licenses/by/4.0/"}):null).filter(e=>!!e)].join("\n\n");n.sourceCode=s,b.Y5.commit()}),(0,I.gC)(),(0,I.En)()}(g);let e=(0,u.UN)(),t=(0,H.VH)(e);(0,R.Jt)(t)}}(t,a,n,v,i),e.type===o.K$p.USER_MESSAGE&&(0,q.gG)((0,s.H5)(e.textContent))&&(0,R.px)()}(0,k.wi)(a.guid,{switchToPreview:!0}),h.zl.set((0,T.o0)(a.guid),!1)}async function W({userMessageContent:e,user:t,chatMessagesNode:a,rawUserChatDetails:n,featureType:i,setInput:r,fileKey:l,autoFixingUserMessageId:c,onFinish:u,forceCompression:m,canUseSupabase:p,changedFiles:g,model:y}){try{if((0,f.vA)(void 0!==o.glU,"Fullscreen must be defined"),!t||!a)return;let u=(0,O.qE)(l,a?.guid||""),v=o.glU.generateUniqueID();c&&(v=c);let _=(0,O.Pd)(l,a?.guid||"",v);l&&!c&&g&&g.length>0&&(0,d.k)().bake_manual_edits&&function({user:e,changedFiles:t,chatMessagesNode:a,featureType:n,fileKey:i}){let r=a.chatMessages||[];if(0===r.length)return;let l=function(e){let t;for(let a=e.length-1;a>=0;a--){let n=e[a];if(n.type===o.K$p.ASSISTANT_MESSAGE){let e=(0,s.lr)(n.textContent||"");if(e.title&&e.title.trim()){t=e.title.trim();break}}}return t}(r)||function(){let e=h.zl.get(C.yV);return e?.name}(),c=(0,P.x)(e,t,void 0,l);$.H.ai("add-manual-edit-system-message",()=>{a.chatMessages=[...r,c],b.Y5.commit()});let u=Object.fromEntries(Object.entries(n===x.lV.FIGMAKE?(0,j.Iz)():(0,j.mf)(a)).map(([e,t])=>[e,t.sourceCode]));(0,G.Oy)({fileKey:i,codeFiles:u}).then(n=>{n&&$.H.ai("enrich-manual-edit-message-with-code-snapshot",()=>{let i=(a.chatMessages||[]).map(a=>{if(a.id===c.id){let i=(0,s.U1)(a.textContent);if(i)return i.codeSnapshot=n,{...a,textContent:(0,s.J6)(i)};let r=(0,P.x)(e,t,n,l);return{...a,textContent:r.textContent}}return a});a.chatMessages=i})}).catch(e=>{console.warn("Failed to create code snapshot for manual edit message:",e)})}({user:t,changedFiles:g,chatMessagesNode:a,featureType:i,fileKey:l});let w={id:v,type:o.K$p.USER_MESSAGE,userId:t.id,textContent:(0,s.J6)(e),sentAt:Date.now(),toolCalls:[],toolResults:[]};await B({newMessage:w,user:t,chatMessagesNode:a,rawUserChatDetails:n,featureType:i,persistentEntityId:u,clientLifecycleId:_,setInput:r,fileKey:l,forceCompression:m,model:y,canUseSupabase:p})}finally{u?.()}}function Z(){return h.zl.get(C.ze)}async function Q(){let e=Z();if(!e)return;let{connectedProject:t,isConnectedNonOwner:a}=await E.M4.fetch((0,V.TT)({fileKey:e})),s={projectId:t?.id,publicAnonKey:t?.public_anon_key,makeNamespace:t?.make_namespace,isConnectedNonOwner:!!a};return s?.projectId&&s?.publicAnonKey&&s?.makeNamespace&&function(e,t,a){let s=(0,u.UN)();if(!s.getInternalCanvas())return;let n=(0,j._J)(`/${L.o3}`),i=(0,j._J)(`/${L.Or}`);$.H.system("create-supabase-files",()=>{if(!n){let t=o.glU?.createNewCodeFile("kv_store.tsx","",null);if(!t)return;let n=s.get(t);if(!n)return;n.sourceCode=(0,L._u)(a,e),n.codeFilePath=L.o3}if(!i){let a=o.glU?.createNewCodeFile("info.tsx","",null);if(!a)return;let n=s.get(a);if(!n)return;n.sourceCode=(0,L.OP)(e,t),n.codeFilePath=L.Or}b.Y5.commit()})}(s.projectId,s.publicAnonKey,s.makeNamespace),(0,K.r)(),s}},314753:(e,t,a)=>{a.d(t,{t:()=>s});class s{constructor(){this.targetContentX=0,this.currentTime=0,this.isAborted=!1,this.isStreamDone=!1,this.lastCodeFile=null,this.queuedDeltas=[],this.renderedContentX=0,this.startTime=0,this.totalContentLen=0,this.updates=[{deltaTs:-9999,len:0}],this.velocity=100,this.donePromise=new Promise(e=>this.doneResolve=e)}queue(e){this.totalContentLen+=n(e),this.queuedDeltas.push(i(e)),0===this.startTime&&(this.startTime=Date.now()),this.updates.push({deltaTs:(Date.now()-this.startTime)/1e3,len:this.totalContentLen})}next(){if(0===this.startTime||0===this.queuedDeltas.length)return[];let e=(Date.now()-this.startTime)/1e3,t=this.updates[this.updates.length-1].len+(this.isStreamDone?100:0),a=.9*e-.3,s=this.updates.filter(e=>e.deltaTs<a).map(e=>e.len);if(0===s.length&&this.isStreamDone){let e=[...this.queuedDeltas];return this.queuedDeltas=[],this.renderedContentX=this.totalContentLen,e}let r=s.length>0?s[s.length-1]:0,l=function(e,t,a,s=.01){if(t===a)return t;let n=e(t);for(;n<-s;){let s=(t+a)/2,i=e(s);i<=0?(t=s,n=i):a=s}return t}(a=>{let s=(a-this.targetContentX)/(e-this.currentTime);return 2e-5*(1/(e-this.currentTime))*(s-this.velocity)-1/(a-r)+1/(t-a)},r,t),o=(l-this.targetContentX)/(e-this.currentTime);this.velocity=.99*this.velocity+.010000000000000009*o,this.currentTime=e,this.targetContentX=Math.floor(Math.max(l,this.targetContentX));let c=this.renderedContentX,u=[];for(;this.queuedDeltas.length>0;){let e=this.queuedDeltas[0],t=n(e);if(0===t){u.push(e),this.queuedDeltas.shift();continue}if((c+=t)>this.targetContentX){let a=this.targetContentX-c,s=t+a;switch(e.type){case"message":case"plan":case"summary":case"work":let n=i(e);n.message=n.message.slice(0,a),e.message=e.message.slice(s),u.push(n);break;case"code":let r=i(e);r.file!==this.lastCodeFile?this.queuedDeltas.shift():(r.code=r.code.slice(0,a),e.code=e.code.slice(s)),this.lastCodeFile=e.file,u.push(r);break;case"reasoning":let l=i(e);l.reasoning=l.reasoning.slice(0,a),e.reasoning=e.reasoning.slice(s),u.push(l);break;case"codeDiffVisualizationDelta":let o=i(e);o.old_str.length>s?(o.old_str=o.old_str.slice(0,s),o.new_str="",e.old_str=e.old_str.slice(s)):(e.old_str="",o.new_str=o.new_str.slice(0,s-o.old_str.length),e.new_str=e.new_str.slice(s-o.old_str.length)),u.push(o);break;default:console.warn("Unknown smooth delta type",e.type)}this.renderedContentX+=s;break}if(this.renderedContentX+=t,u.push(i(e)),this.queuedDeltas.shift(),c===this.targetContentX)break}return u}async onRender(e){for(;(!this.isStreamDone||this.renderedContentX<this.totalContentLen||this.queuedDeltas.length>0)&&!this.isAborted;){let t=this.next();if(this.isStreamDone&&0===t.length)break;t.forEach(e),await new Promise(e=>setTimeout(e,16))}this.doneResolve()}abort(){this.isAborted=!0,this.doneResolve()}done(){return this.isStreamDone=!0,0===this.startTime&&this.doneResolve(),this.donePromise}}function n(e){switch(e.type){case"message":case"plan":case"summary":case"work":return e.message.length;case"code":return e.code.length;case"reasoning":return e.reasoning.length;case"codeDiffVisualizationDelta":return e.old_str.length+e.new_str.length;default:return 0}}function i(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}},887437:(e,t,a)=>{a.d(t,{Pd:()=>o,eM:()=>u,oL:()=>l,qE:()=>c,rH:()=>r});var s=a(989232),n=a(508328),i=a(897659);function r(e,t,a,n){s.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.chat_message_sent",{messageHistoryLength:t,featureType:e,productType:e===i.lV.FIGMAKE?"figmake":"sites",persistentEntityId:a,clientLifecycleId:n})}function l(e,t,a,n,r,l,o,c){s.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.chat_response_received",{featureType:e,productType:e===i.lV.FIGMAKE?"figmake":"sites",timeToFirstCharacterMs:a?a-t:void 0,totalResponseTimeMs:n-t,persistentEntityId:l,clientLifecycleId:o,toolCalls:JSON.stringify(r.map(e=>`${e.toolName}${"command"in e.partialArgs?" "+e.partialArgs.command:""}`)),toolCallsMessageLength:r.reduce((e,t)=>e+JSON.stringify(t.partialArgs).length,0),abortReason:c})}function o(e,t,a){return(0,n.F)(e+"-"+t+"-"+a)}function c(e,t){return(0,n.F)(e+"-"+t)}function u({featureType:e,persistentEntityId:t,clientLifecycleId:a,fileUpdates:n}){for(let r of Object.values(n)){let n=r.match(/https:\/\/images\.unsplash\.com\/photo-[a-zA-Z0-9_-]+(?:\?[a-zA-Z0-9_=&-]*)?/g)||[];n&&n.forEach(n=>s.definedAnalyticsHandler.trackDefinedEvent("ai_for_production.llm_generated_image_url",{featureType:e,productType:e===i.lV.FIGMAKE?"figmake":"sites",persistentEntityId:t,clientLifecycleId:a,imageUrl:n}))}}},522277:(e,t,a)=>{a.d(t,{r:()=>o});var s=a(999667),n=a(730143),i=a(660580),r=a(906329),l=a(855892);async function o(){let e=s.zl.get(n.ze),{authenticated:t}=await i.M4.fetch((0,l.y7)({fileKey:e}),{policy:"networkOnly"});await i.M4.fetch((0,l.TT)({fileKey:e}),{policy:"networkOnly"}),t&&await i.M4.fetch((0,l.YF)({fileKey:e}),{policy:"networkOnly"}),s.zl.set(r.rK,!0)}},120124:(e,t,a)=>{a.d(t,{m:()=>n});var s=a(749214);let n=(0,a(848318).memo)(function(e){return(0,s.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,s.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16m0 1a9 9 0 1 0 0-18 9 9 0 0 0 0 18",clipRule:"evenodd"})})})},434463:(e,t,a)=>{a.d(t,{v:()=>n});var s=a(749214);let n=(0,a(848318).memo)(function(e){return(0,s.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,s.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M7.5 4a.5.5 0 0 0-.5.5V7H4.5a.5.5 0 0 0 0 1H7v8H4.5a.5.5 0 0 0 0 1H7v2.5a.5.5 0 0 0 1 0V17h8v2.5a.5.5 0 0 0 1 0V17h2.5a.5.5 0 0 0 0-1H17V8h2.5a.5.5 0 0 0 0-1H17V4.5a.5.5 0 0 0-1 0V7H8V4.5a.5.5 0 0 0-.5-.5M16 8H8v8h8z",clipRule:"evenodd"})})})},239436:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(749214);let n=(0,a(848318).memo)(function(e){return(0,s.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,s.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"m14.28 10-.229-.684L12 3.162 9.949 9.316 9.72 10H3.16l4.832 3.397.608.427-.235.706-1.928 5.81 4.972-3.647.59-.433.592.433 4.972 3.646-1.928-5.81-.235-.705.608-.427L20.84 10zM9 9H3.16c-.976 0-1.373 1.256-.574 1.818l4.83 3.397-1.928 5.81c-.307.924.755 1.697 1.54 1.12L12 17.5l4.972 3.646c.785.576 1.847-.197 1.54-1.122l-1.928-5.81 4.83-3.396c.8-.562.402-1.818-.575-1.818H15l-2.05-6.154c-.304-.912-1.594-.912-1.898 0z",clipRule:"evenodd"})})})},808827:(e,t,a)=>{a.d(t,{B:()=>r});var s=a(749214),n=a(848318),i=a(58153);let r=(0,n.memo)(function(e){return(0,i.O)()?(0,s.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,s.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M4 5.5a.5.5 0 0 1 .5-.5h15a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V6h-6.5v13H15a.5.5 0 0 1 0 1H9a.5.5 0 0 1 0-1h2.5V6H5v2.5a.5.5 0 0 1-1 0z",clipRule:"evenodd"})}):(0,s.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,s.jsx)("path",{fill:"var(--color-icon)",fillRule:"evenodd",d:"M4 5.5a.5.5 0 0 1 .5-.5h14a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V6h-6v12h2.5a.5.5 0 0 1 0 1h-6a.5.5 0 0 1 0-1H11V6H5v2.5a.5.5 0 0 1-1 0z",clipRule:"evenodd"})})})},840270:(e,t,a)=>{a.d(t,{OP:()=>r,Or:()=>n,_u:()=>i,o3:()=>s});let s="supabase/functions/server/kv_store.tsx",n="components/supabase/info.tsx";function i(e,t){return`
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

/* Table schema:
CREATE TABLE kv_store_${e} (
  key TEXT NOT NULL PRIMARY KEY,
  value JSONB NOT NULL
);
*/

// View at https://supabase.com/dashboard/project/${t}/database/tables

// This file provides a simple key-value interface for storing Figma Make data. It should be adequate for most small-scale use cases.
import { createClient } from "jsr:@supabase/supabase-js@2.49.8";

const client = () => createClient(
  Deno.env.get("SUPABASE_URL"),
  Deno.env.get("SUPABASE_SERVICE_ROLE_KEY"),
);

// Set stores a key-value pair in the database.
export const set = async (key: string, value: any) => {
  const supabase = client()
  const { error } = await supabase.from("kv_store_${e}").upsert({
    key,
    value
  });
  if (error) {
    throw new Error(error.message);
  }
};

// Get retrieves a key-value pair from the database.
export const get = async (key: string) => {
  const supabase = client()
  const { data, error } = await supabase.from("kv_store_${e}").select("value").eq("key", key).maybeSingle();
  if (error) {
    throw new Error(error.message);
  }
  return data?.value;
};

// Delete deletes a key-value pair from the database.
export const del = async (key: string) => {
  const supabase = client()
  const { error } = await supabase.from("kv_store_${e}").delete().eq("key", key);
  if (error) {
    throw new Error(error.message);
  }
};

// Sets multiple key-value pairs in the database.
export const mset = async (keys: string[], values: any[]) => {
  const supabase = client()
  const { error } = await supabase.from("kv_store_${e}").upsert(key.map((k, i) => ({ key: k, value: values[i] })));
  if (error) {
    throw new Error(error.message);
  }
};

// Gets multiple key-value pairs from the database.
export const mget = async (keys: string[]) => {
  const supabase = client()
  const { data, error } = await supabase.from("kv_store_${e}").select("value").in("key", keys);
  if (error) {
    throw new Error(error.message);
  }
  return data?.map((d) => d.value);
};

// Deletes multiple key-value pairs from the database.
export const mdel = async (keys: string[]) => {
  const supabase = client()
  const { error } = await supabase.from("kv_store_${e}").delete().in("key", keys);
  if (error) {
    throw new Error(error.message);
  }
};
`.trim()}function r(e,t){return`
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "${e}"
export const publicAnonKey = "${t}"
`.trim()}}}]);

//# debugId=c480bf94-ce82-5ca3-8c13-505be84af8e0

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/62e389604f9a6bff54640dbe68a9634f39f1a685/3041-afcb98e205681bab.min.js.map